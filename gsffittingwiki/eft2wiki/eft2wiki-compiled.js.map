{"version":3,"sources":["eft2wiki.js"],"names":[],"mappings":"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","file":"eft2wiki-compiled.js","sourcesContent":["(function () {\r\n    'use strict';\r\n\r\n    var eftForm = document.getElementById('eftForm');\r\n    var inputTextarea = document.getElementById('efttextarea');\r\n\r\n    var EFT_SECTIONS = [\r\n        [\r\n            'name',\r\n            'low',\r\n            'med',\r\n            'high',\r\n            'rig',\r\n            'sub'\r\n        ],\r\n        [\r\n            'drone'\r\n        ],\r\n        [\r\n            'implant'\r\n        ],\r\n        [\r\n            'cargo'\r\n        ]\r\n    ];\r\n\r\n\r\n    class ItemPromise {\r\n        constructor(requestName) {\r\n            this.requestName = requestName;\r\n            this.result = null;\r\n\r\n            this.promise = new Promise((resolve, reject) => {\r\n                this.resolve = resolve;\r\n                this.reject = reject;\r\n            });\r\n\r\n            this.promise.then((result) => {\r\n                console.log(result);\r\n                this.result = result;\r\n            });\r\n        }\r\n\r\n        then(...args) {\r\n            return this.promise.then(...args);\r\n        }\r\n\r\n        catch(...args) {\r\n            return this.promise.then(...args);\r\n        }\r\n    }\r\n\r\n    class TypeNameToTypeIDResolver {\r\n        constructor() {\r\n            this.itemPromises = new Map();\r\n        }\r\n\r\n        get(typeName) {\r\n            if (typeName === null) {\r\n                return null;\r\n            }\r\n\r\n            if (!this.itemPromises.has(typeName)) {\r\n                this.itemPromises.set(typeName, new ItemPromise(typeName));\r\n            }\r\n\r\n            return this.itemPromises.get(typeName);\r\n        }\r\n\r\n        doFetch() {\r\n            let names = '';\r\n            for (let k of this.itemPromises.keys()) {\r\n                names = names + '|' + k\r\n            }\r\n\r\n            names = names.substr(1, names.length - 1);\r\n\r\n            fetch('http://micro.evetoolkit.net/api/nameToID?names=' + names)\r\n                .then(this.fetchResolved.bind(this))\r\n                .then(this.contentResolved.bind(this))\r\n                .catch(function (ex) {\r\n                    console.log('parsing failed', ex)\r\n                })\r\n        }\r\n\r\n        fetchResolved(response) {\r\n            if (response.status === 200) {\r\n                return response.json();\r\n            } else {\r\n                for (let p of this.itemPromises.values()) {\r\n                    p.reject();\r\n                }\r\n            }\r\n        }\r\n\r\n        contentResolved(types) {\r\n            for (let t of types) {\r\n                let p = this.itemPromises.get(t.typeName);\r\n                if (p) {\r\n                    p.resolve(t);\r\n                    this.itemPromises.delete(t.typeName);\r\n                }\r\n            }\r\n\r\n            for (let v of this.itemPromises.values()) {\r\n                v.reject('Not Found');\r\n            }\r\n\r\n            this.itemPromises.clear();\r\n        }\r\n\r\n        *unresolved() {\r\n            for (let itemPromise of this.itemPromises.values()) {\r\n                yield itemPromise.promise;\r\n            }\r\n        }\r\n\r\n        all() {\r\n            return Promise.all(this.unresolved());\r\n        }\r\n    }\r\n\r\n    function startProcessEFT(event) {\r\n        event.preventDefault();\r\n\r\n        let inputs = Array.from(eftForm.querySelectorAll('textarea'))\r\n            .concat(Array.from(eftForm.querySelectorAll('input')))\r\n            .concat(Array.from(eftForm.querySelectorAll('button')));\r\n\r\n        for (let t of inputs) {\r\n            t.disabled = true;\r\n        }\r\n\r\n        parseEFT(inputTextarea.value);\r\n    }\r\n\r\n\r\n    function parseEFT(eft) {\r\n        var resolver = new TypeNameToTypeIDResolver();\r\n\r\n        var lines = eft.split('\\n');\r\n\r\n        var fit = {\r\n            'name': '',\r\n            'ship': '',\r\n            'high': [],\r\n            'med': [],\r\n            'low': [],\r\n            'rig': [],\r\n            'sub': [],\r\n            'drone': [],\r\n            'implant': [],\r\n            'charge': [],\r\n            'cargo': []\r\n        };\r\n\r\n        var state_a = 0,\r\n            state_b = 0;\r\n\r\n        var prevLineBlank = false;\r\n        for (let i = 0; i < lines.length; i++) {\r\n            let line = lines[i].trim();\r\n\r\n            if (line === '') {\r\n                if (prevLineBlank) {\r\n                    state_a++;\r\n                    state_b = 0;\r\n                } else {\r\n                    state_b++;\r\n                }\r\n                prevLineBlank = true;\r\n                continue;\r\n            } else {\r\n                prevLineBlank = false;\r\n            }\r\n\r\n\r\n            let bits = [];\r\n            switch (EFT_SECTIONS[state_a][state_b]) {\r\n                case 'name':\r\n                    // remove leading an trailing []\r\n                    line = line.substr(1, line.length - 2);\r\n                    bits = line.split(',');\r\n\r\n                    fit.ship = resolver.get(bits[0]);\r\n                    fit.name = bits[1].trim();\r\n\r\n                    break;\r\n                case 'high':\r\n                case 'med':\r\n                case 'low':\r\n                    bits = line.split(',');\r\n\r\n                    let charge = null;\r\n                    if (bits.length > 1) {\r\n                        charge = bits[1].trim();\r\n                    }\r\n\r\n                    fit[EFT_SECTIONS[state_a][state_b]].push(resolver.get(bits[0]));\r\n                    if (charge != null) {\r\n                        fit['charge'].push(resolver.get(charge))\r\n                    }\r\n\r\n                    break;\r\n                case 'drone':\r\n                case 'cargo':\r\n                    bits = line.match(/^(.*?)( x[0-9]+)?$/);\r\n\r\n                    let qty = null;\r\n                    if (bits[2]) {\r\n                        let qtyStr = bits[2];\r\n                        qty = parseInt(qtyStr.substr(2, qtyStr.length - 1));\r\n                    }\r\n\r\n                    fit[EFT_SECTIONS[state_a][state_b]].push({\r\n                        'item': resolver.get(bits[1]),\r\n                        'qty': qty\r\n                    });\r\n\r\n                    break;\r\n                default:\r\n                    fit[EFT_SECTIONS[state_a][state_b]].push(resolver.get(line));\r\n            }\r\n        }\r\n\r\n        resolver.doFetch();\r\n\r\n        resolver.all().then(\r\n            (value) => {\r\n                console.log(value);\r\n                outputWiki(fit);\r\n            },\r\n            (err) => {\r\n                console.log(err)\r\n            }\r\n        );\r\n    }\r\n\r\n    function outputWiki(fit) {\r\n        var output = `{{#widget:ShipFitting\r\n| ship=${fit.ship.result.typeName}\r\n| shipTypeID=${fit.ship.result.typeID}\r\n| fitName=${fit.name}\\n`;\r\n\r\n        for (let i = 0; i < fit.high.length; i++) {\r\n            let item = fit.high[i];\r\n            output += `| high${i + 1}name=${item.result.typeName}\r\n| high${i + 1}typeID=${item.result.typeID}\\n`\r\n        }\r\n        for (let i = 0; i < fit.med.length; i++) {\r\n            let item = fit.med[i];\r\n            output += `| mid${i + 1}name=${item.result.typeName}\r\n| mid${i + 1}typeID=${item.result.typeID}\\n`\r\n        }\r\n        for (let i = 0; i < fit.low.length; i++) {\r\n            let item = fit.low[i];\r\n            output += `| low${i + 1}name=${item.result.typeName}\r\n| low${i + 1}typeID=${item.result.typeID}\\n`\r\n        }\r\n\r\n        for (let i = 0; i < fit.sub.length; i++) {\r\n            let item = fit.sub[i];\r\n            output += `| subsystem${i + 1}name=${item.result.typeName}\r\n| subsystem${i + 1}typeID=${item.result.typeID}\\n`\r\n        }\r\n\r\n        for (let i = 0; i < fit.rig.length; i++) {\r\n            let item = fit.rig[i];\r\n            output += `| rig${i + 1}name=${item.result.typeName}\r\n| rig${i + 1}typeID=${item.result.typeID}\\n`\r\n        }\r\n\r\n        for (let i = 0; i < fit.drone.length; i++) {\r\n            let item = fit.drone[i].item;\r\n            output += `| drone${i + 1}name=${item.result.typeName}\r\n| drone${i + 1}typeID=${item.result.typeID}\\n`\r\n        }\r\n\r\n        var charges = [];\r\n        for (let i = 0; i < fit.charge.length; i++) {\r\n            let item = fit.charge[i];\r\n            if (charges.indexOf(item.result.typeName) < 0) {\r\n                output += `| charge${i + 1}name=${item.result.typeName}\r\n| charge${i + 1}typeID=${item.result.typeID}\\n`\r\n\r\n                charges.push(item.result.typeName);\r\n            }\r\n        }\r\n\r\n        var difficultyElm = document.getElementById('difficulty');\r\n        var difficulty = difficultyElm.options[difficultyElm.selectedIndex].value;\r\n        var version = document.getElementById('version').value;\r\n\r\n        output += `| difficulty=${difficulty}\\n`;\r\n        output += `| version=${version}\\n`;\r\n\r\n        var group1name = document.getElementById('group_1_name').value;\r\n        var group1icon = document.getElementById('group_1_icon').value;\r\n        var group2name = document.getElementById('group_2_name').value;\r\n        var group2icon = document.getElementById('group_2_icon').value;\r\n        var group3name = document.getElementById('group_3_name').value;\r\n        var group3icon = document.getElementById('group_3_icon').value;\r\n        var group4name = document.getElementById('group_4_name').value;\r\n        var group4icon = document.getElementById('group_4_icon').value;\r\n\r\n        if (group1name) {\r\n            output += `| group.${group1name}=${group1icon}\\n`;\r\n        }\r\n        if (group2name) {\r\n            output += `| group.${group2name}=${group2icon}\\n`;\r\n        }\r\n        if (group3name) {\r\n            output += `| group.${group3name}=${group3icon}\\n`;\r\n        }\r\n        if (group4name) {\r\n            output += `| group.${group4name}=${group4icon}\\n`;\r\n        }\r\n\r\n        var notes = document.getElementById('notes').value;\r\n\r\n        output += `| notes=${notes}\\n`;\r\n\r\n        var cargo = '';\r\n        for (let i = 0; i < fit.drone.length; i++) {\r\n            let item = fit.drone[i];\r\n            cargo += `${item.item.result.typeName} x${item.qty}\\n`;\r\n        }\r\n        if (cargo === '') {\r\n            cargo = '\\n';\r\n        }\r\n\r\n        output += `| cargo=${cargo}`;\r\n        output += '}}';\r\n\r\n        let o = document.getElementsByTagName('output')[0];\r\n        o.innerText = output;\r\n    }\r\n\r\n\r\n    eftForm.addEventListener('submit', startProcessEFT);\r\n\r\n})();"]}